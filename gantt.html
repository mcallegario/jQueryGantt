<!DOCTYPE HTML>
<html>
<head>
  <title>Teamwork</title>

<!-- Seção de inclusão das Bibliotecas --> 
<script src="https://iexpress.ingty.com/MyLib/libs/jquery/jquery-2.1.1.min.js"></script>
<script src="https://iexpress.ingty.com/MyLib/libs/js/underscore-min.js" type="text/javascript"></script>

<script type="text/javascript" src="https://iexpress.ingty.com/MyLib/libs/jquery/jquery-ui.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://iexpress.ingty.com/MyLib/libs/jquery/jquery-ui.css">
<link rel="stylesheet" type="text/css" href="https://iexpress.ingty.com/MyLib/libs/jquery/jquery.multiselect.css">

<!-- <script src="https://iexpress.ingty.com/MyLib/libs/bootstrap3/js/bootstrap.min.js"></script> 
<link  href="https://iexpress.ingty.com/MyLib/libs/bootstrap3/css/bootstrap.min.css" rel="stylesheet" /> -->

<link rel="stylesheet" type="text/css" href="https://iexpress.ingty.com/MyLib/libs/dataTables/datatables.min.css">

<script type="text/javascript" src="https://iexpress.ingty.com/MyLib/libs/dataTables/datatables.min.js"></script>  
<script type="text/javascript" src="https://cdn.datatables.net/plug-ins/1.10.12/sorting/date-euro.js"></script>
<script type="text/javascript" src="https://iexpress.ingty.com/MyLib/libs/dataTables/dataTables.rowsGroup.js"></script>
<script type="text/javascript" src="https://iexpress.ingty.com/MyLib/libs/dataTables/dataTables.treeGrid.js"></script>
<!-- <script type="text/javascript" src="https://iexpress.ingty.com/MyLib/libs/dataTables/ColReorderWithResize.js"></script> -->
<script type="text/javascript" src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>

<link rel="stylesheet" type="text/css" href="https://iexpress.ingty.com/MyLib/libs/bootstrap/4.4.1/bootstrapcustom.min.css">

<script type="text/javascript" src="https://iexpress.ingty.com/MyLib/libs/pdfmake/pdfmake.min.js"></script> 
<script type="text/javascript" src="https://iexpress.ingty.com/MyLib/libs/pdfmake/vfs_fonts.js"></script> 
<script type="text/javascript" src="https://iexpress.ingty.com/MyLib/libs/pdfmake/html2pdfmake.js"></script> 

<script type="text/javascript" src="https://iexpress.ingty.com/MyLib/libs/dataTables/cfgIngty.js"></script> 

<!-- pdfmake files: -->
<script type="text/javascript" src="https://iexpress.ingty.com/MyLib/libs/pdfmake/pdfmake.min.js"></script> 
<script type="text/javascript" src="https://iexpress.ingty.com/MyLib/libs/pdfmake/vfs_fonts.js"></script> 
<script type="text/javascript" src="https://iexpress.ingty.com/MyLib/libs/pdfmake/html2pdfmake.js"></script> 

<script src="https://iexpress.ingty.com/MyLib/libs/moment/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment-recur/1.0.7/moment-recur.js"></script>
<script src="https://iexpress.ingty.com/MyLib/libs/moment/locale/pt-br.js"></script>

<script src="https://iexpress.ingty.com/MyLib/libs/numeral/numeral.min.js" type="text/javascript"></script>
<script src="https://iexpress.ingty.com/MyLib/libs/numeral/locales/pt-br.min.js" type="text/javascript"></script>

<link rel="stylesheet" type="text/css" href="https://iexpress.ingty.com/MyLib/libs/keen-dataviz/keen-dashboards.css">
<link rel="stylesheet" type="text/css" href="https://iexpress.ingty.com/MyLib/libs/keen-dataviz/dashboard.css">

<link rel="Stylesheet" type="text/css" href="https://iexpress.ingty.com/MyLib/libs/js/wSelect.css" />
<script type="text/javascript" src="https://iexpress.ingty.com/MyLib/libs/js/wSelect.min.js"></script>

<!--link rel="stylesheet" type="text/css" href="https://iexpress.ingty.com/MyLib/libs/vis/vis.min.css">
<script type="text/javascript" src="https://iexpress.ingty.com/MyLib/libs/vis/vis.min.js"></script!-->
<script src="https://iexpress.ingty.com/MyLib/libs/vis/vis-timeline-graph2d.min.js"></script>
<link href="https://iexpress.ingty.com/MyLib/libs/vis/vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css" />


<script src="https://iexpress.ingty.com/MyLib/libs/js/echarts.min.js" type="text/javascript"></script>
<script src="https://iexpress.ingty.com/MyLib/libs/js/echarts-gl.min.js" type="text/javascript"></script>

<script src="https://iexpress.ingty.com/MyLib/libs/js/datajs-1.1.2.js" type="text/javascript"></script>
<script src="https://iexpress.ingty.com/MyLib/libs/js/Common.js" type="text/javascript"></script>
<script src="https://iexpress.ingty.com/MyLib/libs/js/oDataPS.js" type="text/javascript"></script>

<script src="https://iexpress.ingty.com/MyLib/libs/SPServices/jquery.SPServices.min.js" type="text/javascript"></script>
<script src="https://iexpress.ingty.com/MyLib/libs/SharepointPlus/sharepointplus.js" type="text/javascript"></script>

<script type="text/javascript" src="https://iexpress.ingty.com/MyLib/libs/js/bootstrap-notify.js" ></script>
<link rel="stylesheet" type="text/css" href="https://iexpress.ingty.com/MyLib/libs/js/animate.min.css">
<link rel="stylesheet" type="text/css" href="https://iexpress.ingty.com/MyLib/libs/js/bootstrap-notify.css">

<script type="text/javascript" src="https://iexpress.ingty.com/MyLib/libs/jquery/jquery-confirm.min.js" ></script>
<link rel="stylesheet" type="text/css" href="https://iexpress.ingty.com/MyLib/libs/jquery/jquery-confirm.min.css">


<!--<link rel="stylesheet" href="https://iexpress.ingty.com/MyLib/libs/fontawesome-free-5.13.0-web/css/all.css"> 
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">-->

<link rel="stylesheet" href="https://iexpress.ingty.com/MyLib/libs/newSlickGrid/styles/css/slickgrid-theme-salesforce.css" type="text/css"/>

<script src="https://ingty.sharepoint.com/sites/pwa_dev/MyLib/iexpress/libs/ingtyLog.js?_ver=DDMMAAAA.HHMM" type="text/javascript"></script> 
<script src="https://ingty.sharepoint.com/sites/pwa_dev/MyLib/iexpress/libs/cfg.js?_ver=DDMMAAAA.HHMM" type="text/javascript"></script> 
<script src="https://ingty.sharepoint.com/sites/pwa_dev/MyLib/iexpress/libs/DAL_sp.js?_ver=DDMMAAAA.HHMM" type="text/javascript"></script> 



<script src="https://iexpress.ingty.com/MyLib/libs/select/comboTreePlugin.js"  type="text/javascript"></script>
<link rel="stylesheet" href="https://iexpress.ingty.com/MyLib/libs/select/style.css">







  <link rel=stylesheet href="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/platform.css" type="text/css">
  <link rel=stylesheet href="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/libs/jquery/dateField/jquery.dateField.css" type="text/css">

  <link rel=stylesheet href="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/gantt-ingty.css" type="text/css">
  <link rel=stylesheet href="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/ganttPrint.css" type="text/css" media="print">
  <link rel=stylesheet href="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/libs/jquery/valueSlider/mb.slider.css" type="text/css" media="print">

  <!-- <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script> -->

  <script src="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/libs/jquery/jquery.livequery.1.1.1.min.js"></script>
  <script src="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/libs/jquery/jquery.timers.js"></script>

  <script src="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/libs/utilities.js"></script>
  <script src="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/libs/forms.js"></script>
  <script src="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/libs/date.js"></script>
  <script src="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/libs/dialogs.js"></script>
  <script src="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/libs/layout.js"></script>
  <script src="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/libs/i18nJs-pt_br.js"></script>
  <script src="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/libs/jquery/dateField/jquery.dateField.js"></script>
  <script src="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/libs/jquery/JST/jquery.JST.js"></script>
  <script src="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/libs/jquery/valueSlider/jquery.mb.slider.js"></script>

  <script type="text/javascript" src="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/libs/jquery/svg/jquery.svg.min.js"></script>
  <script type="text/javascript" src="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/libs/jquery/svg/jquery.svgdom.1.8.js"></script>

  <script src="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/ganttUtilities.js"></script>
  <script src="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/ganttTask.js"></script>
  <script src="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/ganttDrawerSVG.js"></script>
  <script src="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/ganttZoom.js"></script>
  <script src="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/ganttGridEditor.js"></script>
  <script src="https://iexpress.ingty.com/MyLib/libs/jQueryGantt/ganttMaster.js"></script>  


  <!--<script src="libs/profiling.js"></script>-->
  <!--<script type="text/javascript" src="ganttTestSuite.js"></script>-->
</head>
<body style="background-color: #fff;">



<div id="workSpace" style="padding:0px; overflow-y:auto; overflow-x:hidden;border:1px solid #e5e5e5;position:relative;margin:0 5px"></div>

<style>
  .resEdit {
    padding: 15px;
  }

  .resLine {
    width: 95%;
    padding: 3px;
    margin: 5px;
    border: 1px solid #d0d0d0;
  }

  body {
    overflow: hidden;
  }

  .ganttButtonBar h1{
    color: #000000;
    font-weight: bold;
    font-size: 28px;
    margin-left: 10px;
  }

</style>

<!-- <fo rm id="gimmeBack" style="display:none;" action="../gimmeBack.jsp" method="post" target="_blank"><input type="hidden" name="prj" id="gimBaPrj"></fo rm> -->

<script type="text/javascript">
//https://roberto.twproject.com/2012/08/24/jquery-gantt-editor/
var ge;
$(function() {
  var canWrite=true; //Este é o padrão para fins de teste

  // Aqui começa a inicialização do Gantt
  ge = new GanttMaster();
  ge.set100OnClose=true;
  ge.resourceUrl = 'https://iexpress.ingty.com/MyLib/libs/jQueryGantt/res/';

  ge.shrinkParent=true;

  ge.init($("#workSpace"));
  loadI18n(); //substituir com os localizados

  //A fim de forçar a calcular o nível de zoom mais adequado
  delete ge.gantt.zoom;

  var project=loadFromLocalStorage();

  if (!project.canWrite)
    $(".ganttButtonBar button.requireWrite").attr("disabled","true");

  ge.loadProject(project);
  ge.checkpoint(); //esvazie a pilha de desfazer

  //initializeHistoryManagement(ge.tasks[0].id);
});



function getDemoProject(){
  //console.debug("getDemoProject")
ret= {"tasks":    [
      {"id": -1, 
      "name": "Gantt editor", 
      "progress": 0, 
      "progressByWorklog": false, 
      "relevance": 0, 
      "type": "", 
      "typeId": "", 
      "description": "", 
      "code": "", 
      "level": 0, 
      "status": "STATUS_ACTIVE", 
      "depends": "", 
      "canWrite": true, 
      "start": 1396994400000, 
      "entrega": false, 
      "duration": 20, 
      "end": 1399586399999, 
      "startIsMilestone": true, 
      "endIsMilestone": true, 
      "collapsed": false, 
      "assigs": [], 
      "hasChild": true},
      {"id": -2, "name": "coding", "progress": 0, "progressByWorklog": false, "relevance": 0, "type": "", "typeId": "", "description": "", "code": "", "level": 1, "status": "STATUS_ACTIVE", "depends": "", "canWrite": true, "start": 1396994400000, "entrega": false, "duration": 10, "end": 1398203999999, "startIsMilestone": false, "endIsMilestone": false, "collapsed": false, "assigs": [], "hasChild": true},
      {"id": -3, "name": "gantt part", "progress": 0, "progressByWorklog": false, "relevance": 0, "type": "", "typeId": "", "description": "", "code": "", "level": 2, "status": "STATUS_ACTIVE", "depends": "", "canWrite": true, "start": 1396994400000, "entrega": true, "duration": 2, "end": 1397167199999, "startIsMilestone": false, "endIsMilestone": false, "collapsed": false, "assigs": [], "hasChild": false},
      {"id": -4, "name": "editor part", "progress": 0, "progressByWorklog": false, "relevance": 0, "type": "", "typeId": "", "description": "", "code": "", "level": 2, "status": "STATUS_SUSPENDED", "depends": "3", "canWrite": true, "start": 1397167200000, "entrega": false, "duration": 4, "end": 1397685599999, "startIsMilestone": false, "endIsMilestone": false, "collapsed": false, "assigs": [], "hasChild": false},
      {"id": -5, "name": "testing", "progress": 0, "progressByWorklog": false, "relevance": 0, "type": "", "typeId": "", "description": "", "code": "", "level": 1, "status": "STATUS_SUSPENDED", "depends": "2:5", "canWrite": true, "start": 1398981600000, "entrega": false, "duration": 5, "end": 1399586399999, "startIsMilestone": false, "endIsMilestone": false, "collapsed": false, "assigs": [], "hasChild": true},
      {"id": -6, "name": "test on safari", "progress": 0, "progressByWorklog": false, "relevance": 0, "type": "", "typeId": "", "description": "", "code": "", "level": 2, "status": "STATUS_SUSPENDED", "depends": "", "canWrite": true, "start": 1398981600000, "entrega": false, "duration": 2, "end": 1399327199999, "startIsMilestone": false, "endIsMilestone": false, "collapsed": false, "assigs": [], "hasChild": false},
      {"id": -7, "name": "test on ie", "progress": 0, "progressByWorklog": false, "relevance": 0, "type": "", "typeId": "", "description": "", "code": "", "level": 2, "status": "STATUS_SUSPENDED", "depends": "6", "canWrite": true, "start": 1399327200000, "entrega": true, "duration": 3, "end": 1399586399999, "startIsMilestone": false, "endIsMilestone": false, "collapsed": false, "assigs": [], "hasChild": false},
      {"id": -8, "name": "test on chrome", "progress": 0, "progressByWorklog": false, "relevance": 0, "type": "", "typeId": "", "description": "", "code": "", "level": 2, "status": "STATUS_SUSPENDED", "depends": "6", "canWrite": true, "start": 1399327200000, "entrega": false, "duration": 2, "end": 1399499999999, "startIsMilestone": false, "endIsMilestone": false, "collapsed": false, "assigs": [], "hasChild": false}
    ], "selectedRow": 2, "deletedTaskIds": [],
      "resources": [
      {"id": "tmp_1", "name": "Resource 1"},
      {"id": "tmp_2", "name": "Resource 2"},
      {"id": "tmp_3", "name": "Resource 3"},
      {"id": "tmp_4", "name": "Resource 4"}
    ],
      "roles":       [
      {"id": "tmp_1", "name": "Project Manager"},
      {"id": "tmp_2", "name": "Worker"},
      {"id": "tmp_3", "name": "Stakeholder"},
      {"id": "tmp_4", "name": "Customer"}
    ], 
    "canWrite":    true, 
    "canDelete":true, 
    "canWriteOnParent": true, 
    "canAdd":true
  }


    //actualize data
    var offset=new Date().getTime()-ret.tasks[0].start;
    for (var i=0;i<ret.tasks.length;i++) {
      ret.tasks[i].start = ret.tasks[i].start + offset;
    }
  return ret;
}



function loadGanttFromServer(taskId, callback) {

  //Esta é uma simulação: Carregue dados do armazenamento local, se você já tiver jogado com a demonstração ou uma textarea com dados de demonstração inicial
  var ret=loadFromLocalStorage();

  //this is the real implementation
  /*
  //var taskId = $("#taskSelector").val();
  var prof = new Profiler("loadServerSide");
  prof.reset();

  $.getJSON("ganttAjaxController.jsp", {CM:"LOADPROJECT",taskId:taskId}, function(response) {
    //console.debug(response);
    if (response.ok) {
      prof.stop();

      ge.loadProject(response.project);
      ge.checkpoint(); //empty the undo stack

      if (typeof(callback)=="function") {
        callback(response);
      }
    } else {
      jsonErrorHandling(response);
    }
  });
  */

  return ret;
}

function upload(uploadedFile) {
  var fileread = new FileReader();
  
  fileread.onload = function(e) {
    var content = e.target.result;
    var intern = JSON.parse(content); // Array of Objects.
    //console.log(intern); // You can index every object
    
    ge.loadProject(intern);
    ge.checkpoint(); //empty the undo stack

  };

  fileread.readAsText(uploadedFile);
}

function saveGanttOnServer() {

  //this is a simulation: save data to the local storage or to the textarea
  saveInLocalStorage();

  //var prj = ge.saveProject();

  //download(JSON.stringify(prj, null, '\t'), "MyProject.json", "application/json");

  /*

  delete prj.resources;
  delete prj.roles;

  var prof = new Profiler("saveServerSide");
  prof.reset();

  if (ge.deletedTaskIds.length>0) {
    if (!confirm("TASK_THAT_WILL_BE_REMOVED\n"+ge.deletedTaskIds.length)) {
      return;
    }
  }

  $.ajax("ganttAjaxController.jsp", {
    dataType:"json",
    data: {CM:"SVPROJECT",prj:JSON.stringify(prj)},
    type:"POST",

    success: function(response) {
      if (response.ok) {
        prof.stop();
        if (response.project) {
          ge.loadProject(response.project); //must reload as "tmp_" ids are now the good ones
        } else {
          ge.reset();
        }
      } else {
        var errMsg="Errors saving project\n";
        if (response.message) {
          errMsg=errMsg+response.message+"\n";
        }

        if (response.errorMessages.length) {
          errMsg += response.errorMessages.join("\n");
        }

        alert(errMsg);
      }
    }

  });
  */
}

// Function to download data to a file
function download(data, filename, type) {
  var file = new Blob([data], {type: type});
  if (window.navigator.msSaveOrOpenBlob) // IE10+
    window.navigator.msSaveOrOpenBlob(file, filename);
  else { // Others
    var a = document.createElement("a"),
      url = URL.createObjectURL(file);
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    setTimeout(function() {
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);  
    }, 0); 
  }
}

function newProject(){
  clearGantt();
}


function clearGantt() {
  ge.reset();
}

//-------------------------------------------  Get project file as JSON (used for migrate project from gantt to Teamwork) ------------------------------------------------------
function getFile() {
  $("#gimBaPrj").val(JSON.stringify(ge.saveProject()));
  $("#gimmeBack").submit();
  $("#gimBaPrj").val("");

  /*  var uriContent = "data:text/html;charset=utf-8," + encodeURIComponent(JSON.stringify(prj));
   neww=window.open(uriContent,"dl");*/
}


function loadFromLocalStorage() {
  var ret;
  if (localStorage) {
    if (localStorage.getObject("teamworkGantDemo")) {
      ret = localStorage.getObject("teamworkGantDemo");
    }
  }

  //if not found create a new example task
   if (!ret || !ret.tasks || ret.tasks.length == 0){
    ret=getDemoProject();
  } 

  /*
  ret = {"tasks":[{"TaskId":"4ad50dda-c41b-eb11-aa69-a463a13fd18c","name":"PROJETO MODELO","progress":55,"progressByWorklog":false,"relevance":0,"type":"","code":"0","level":0,"status":"STATUS_ACTIVE","depends":"","canWrite":true,"start":1600074000000,"end":1631808000000,"duration":260,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[],"hasChild":false},{"id":"965","TaskId":"71a2bf77-1cdb-494c-8755-1e48eb6f66bc","name":"INICIAÇÃO","progress":100,"progressByWorklog":false,"relevance":0,"type":"","code":"1","level":1,"status":"STATUS_ACTIVE","depends":"","canWrite":true,"start":1600074000000,"end":1601654400000,"duration":15,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[],"hasChild":false},{"id":"966","TaskId":"cd2ee67d-44a5-4ca8-b03d-bebe3b16b650","name":"TERMO DE ABERTURA","progress":100,"progressByWorklog":false,"relevance":0,"type":"","code":"1.1","level":2,"status":"STATUS_ACTIVE","depends":"","canWrite":true,"start":1600074000000,"end":1601395200000,"duration":12,"startIsMilestone":false,"endIsMilestone":false,"entrega":true,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[],"hasChild":false},{"id":"967","TaskId":"d6b4447a-1bdf-4738-8050-81865123bf36","name":"Criar TAP","progress":100,"progressByWorklog":false,"relevance":0,"type":"","code":"1.1.1","level":3,"status":"STATUS_ACTIVE","depends":"","canWrite":true,"start":1600074000000,"end":1600185600000,"duration":2,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[{"resourceId":"c32d899b-aa78-e911-b076-00155db0cc12","id":"e954fcd3-cd9c-ec11-b0d4-00155d808220","roleId":"tmp_1","effort":19800000}],"hasChild":true},{"id":"968","TaskId":"227a4155-3257-46dc-a2ec-63c342bfdb0f","name":"Aprovar TAP","progress":100,"progressByWorklog":false,"relevance":0,"type":"","code":"1.1.2","level":3,"status":"STATUS_ACTIVE","depends":"4","canWrite":true,"start":1600185600000,"end":1601395200000,"duration":11,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[{"resourceId":"36a544da-e6c5-e911-b080-00155dac4017","id":"f054fcd3-cd9c-ec11-b0d4-00155d808220","roleId":"tmp_1","effort":288000000}],"hasChild":true},{"id":"969","TaskId":"dc0e4ea1-c486-48d3-a396-33e804600ab3","name":"REUNIÃO DE PONTA PÉ","progress":100,"progressByWorklog":false,"relevance":0,"type":"","code":"1.2","level":2,"status":"STATUS_ACTIVE","depends":"","canWrite":true,"start":1601395200000,"end":1601654400000,"duration":4,"startIsMilestone":false,"endIsMilestone":false,"entrega":true,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[],"hasChild":false},{"id":"970","TaskId":"4294b14f-1743-4ec4-b295-7963f9cf9048","name":"Preparar Reunião Ponta Pé","progress":100,"progressByWorklog":false,"relevance":0,"type":"","code":"1.2.1","level":3,"status":"STATUS_ACTIVE","depends":"5","canWrite":true,"start":1601395200000,"end":1601568000000,"duration":3,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[{"resourceId":"c32d899b-aa78-e911-b076-00155db0cc12","id":"fd54fcd3-cd9c-ec11-b0d4-00155d808220","roleId":"tmp_1","effort":57600000}],"hasChild":true},{"id":"971","TaskId":"130ccb0a-e47a-4261-907e-a9d866df34c5","name":"Participar da Reunião de Ponta-pé","progress":100,"progressByWorklog":false,"relevance":0,"type":"","code":"1.2.2","level":3,"status":"STATUS_ACTIVE","depends":"7","canWrite":true,"start":1601568000000,"end":1601654400000,"duration":2,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[{"resourceId":"36a544da-e6c5-e911-b080-00155dac4017","id":"0455fcd3-cd9c-ec11-b0d4-00155d808220","roleId":"tmp_1","effort":28800000}],"hasChild":true},{"id":"972","TaskId":"21a8eac6-4cd9-4289-9968-ca638ac056aa","name":"PLANEJAMENTO","progress":100,"progressByWorklog":false,"relevance":0,"type":"","code":"2","level":1,"status":"STATUS_ACTIVE","depends":"","canWrite":true,"start":1601654400000,"end":1605283200000,"duration":31,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[],"hasChild":false},{"id":"973","TaskId":"3f15a433-1c93-4afe-bfb9-185bdb1d40c6","name":"PLANO DE PROJETO","progress":100,"progressByWorklog":false,"relevance":0,"type":"","code":"2.1","level":2,"status":"STATUS_ACTIVE","depends":"","canWrite":true,"start":1601654400000,"end":1605283200000,"duration":31,"startIsMilestone":false,"endIsMilestone":false,"entrega":true,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[],"hasChild":false},{"id":"974","TaskId":"2179b68b-6f96-46e9-b034-a1ce5ebe219d","name":"Criar Plano","progress":100,"progressByWorklog":false,"relevance":0,"type":"","code":"2.1.1","level":3,"status":"STATUS_ACTIVE","depends":"8","canWrite":true,"start":1601654400000,"end":1604073600000,"duration":21,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[{"resourceId":"c32d899b-aa78-e911-b076-00155db0cc12","id":"1755fcd3-cd9c-ec11-b0d4-00155d808220","roleId":"tmp_1","effort":576000000}],"hasChild":true},{"id":"975","TaskId":"86bed588-668f-44d4-b693-1859d8158409","name":"Aprovar Plano","progress":100,"progressByWorklog":false,"relevance":0,"type":"","code":"2.1.2","level":3,"status":"STATUS_ACTIVE","depends":"11","canWrite":true,"start":1604073600000,"end":1605283200000,"duration":11,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[{"resourceId":"36a544da-e6c5-e911-b080-00155dac4017","id":"1e55fcd3-cd9c-ec11-b0d4-00155d808220","roleId":"tmp_1","effort":288000000}],"hasChild":true},{"id":"976","TaskId":"8759ef89-9d83-4643-95f1-ed30fbc32338","name":"EXECUÇÃO","progress":51,"progressByWorklog":false,"relevance":0,"type":"","code":"3","level":1,"status":"STATUS_ACTIVE","depends":"","canWrite":true,"start":1605283200000,"end":1628870400000,"duration":193,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[],"hasChild":false},{"id":"977","TaskId":"e4995f8b-8865-4e2d-afbd-b00b24006b7b","name":"ENTREGA 1","progress":100,"progressByWorklog":false,"relevance":0,"type":"","code":"3.1","level":2,"status":"STATUS_ACTIVE","depends":"","canWrite":true,"start":1605283200000,"end":1613491200000,"duration":66,"startIsMilestone":false,"endIsMilestone":false,"entrega":true,"inspecao":true,"aquisicao":true,"collapsed":false,"assigs":[],"hasChild":false},{"id":"978","TaskId":"53abbe42-1700-4c3f-b2e2-54a684799841","name":"Criar Entrega 1","progress":100,"progressByWorklog":false,"relevance":0,"type":"","code":"3.1.1","level":3,"status":"STATUS_ACTIVE","depends":"12","canWrite":true,"start":1605283200000,"end":1608912000000,"duration":31,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[{"resourceId":"c32d899b-aa78-e911-b076-00155db0cc12","id":"3155fcd3-cd9c-ec11-b0d4-00155d808220","roleId":"tmp_1","effort":864000000}],"hasChild":true},{"id":"979","TaskId":"ab052d0a-3fb6-4a8c-869c-3a64ab263fb1","name":"Testar Entrega 1","progress":100,"progressByWorklog":false,"relevance":0,"type":"","code":"3.1.2","level":3,"status":"STATUS_ACTIVE","depends":"15","canWrite":true,"start":1608912000000,"end":1612886400000,"duration":31,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[{"resourceId":"36a544da-e6c5-e911-b080-00155dac4017","id":"3855fcd3-cd9c-ec11-b0d4-00155d808220","roleId":"tmp_1","effort":864000000}],"hasChild":true},{"id":"980","TaskId":"6e6caa8c-7400-4e78-994f-0459e5aaf2c8","name":"Validar Entrega 1","progress":100,"progressByWorklog":false,"relevance":0,"type":"","code":"3.1.3","level":3,"status":"STATUS_ACTIVE","depends":"16","canWrite":true,"start":1612886400000,"end":1613491200000,"duration":6,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[{"resourceId":"d9ea99eb-efcf-e911-aefc-a0b3cc177bea","id":"3f55fcd3-cd9c-ec11-b0d4-00155d808220","roleId":"tmp_1","effort":0}],"hasChild":true},{"id":"981","TaskId":"16cc0342-e022-4431-ae55-6afd05a128cb","name":"ENTREGA 2","progress":100,"progressByWorklog":false,"relevance":0,"type":"","code":"3.2","level":2,"status":"STATUS_ACTIVE","depends":"17","canWrite":true,"start":1613491200000,"end":1613577600000,"duration":2,"startIsMilestone":false,"endIsMilestone":false,"entrega":true,"inspecao":true,"aquisicao":false,"collapsed":false,"assigs":[],"hasChild":true},{"id":"982","TaskId":"7a16cb9f-087b-4eb1-b793-da620e590348","name":"ENTREGA 3","progress":48,"progressByWorklog":false,"relevance":0,"type":"","code":"3.3","level":2,"status":"STATUS_ACTIVE","depends":"","canWrite":true,"start":1613577600000,"end":1621612800000,"duration":67,"startIsMilestone":false,"endIsMilestone":false,"entrega":true,"inspecao":true,"aquisicao":false,"collapsed":false,"assigs":[],"hasChild":false},{"id":"983","TaskId":"2320f52f-94be-4a18-8bf8-fe21d2536f38","name":"Criar Entrega 3","progress":100,"progressByWorklog":false,"relevance":0,"type":"","code":"3.3.1","level":3,"status":"STATUS_ACTIVE","depends":"18","canWrite":true,"start":1613577600000,"end":1617206400000,"duration":31,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[{"resourceId":"c32d899b-aa78-e911-b076-00155db0cc12","id":"5255fcd3-cd9c-ec11-b0d4-00155d808220","roleId":"tmp_1","effort":864000000}],"hasChild":true},
  {"id":"984","TaskId":"2f7448e9-52c2-4213-be63-517d60fc088a","name":"Testar Entrega 3","progress":4,"progressByWorklog":false,"relevance":0,"type":"","code":"3.3.2","level":3,"status":"STATUS_ACTIVE","depends":"20","canWrite":true,"start":1617206400000,"end":1621008000000,"duration":32,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[{"resourceId":"36a544da-e6c5-e911-b080-00155dac4017","id":"5955fcd3-cd9c-ec11-b0d4-00155d808220","roleId":"tmp_1","effort":864000000}],"hasChild":true},{"id":"985","TaskId":"9a109289-0f1c-4905-b268-47443ed6ffcc","name":"Validar Entrega 3","progress":0,"progressByWorklog":false,"relevance":0,"type":"","code":"3.3.3","level":3,"status":"STATUS_ACTIVE","depends":"21","canWrite":true,"start":1621008000000,"end":1621612800000,"duration":6,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[],"hasChild":true},{"id":"986","TaskId":"ce6cb316-cd28-4125-8811-c58501f8f5ac","name":"ENTREGA 4","progress":0,"progressByWorklog":false,"relevance":0,"type":"","code":"3.4","level":2,"status":"STATUS_ACTIVE","depends":"","canWrite":true,"start":1621612800000,"end":1628870400000,"duration":61,"startIsMilestone":false,"endIsMilestone":false,"entrega":true,"inspecao":true,"aquisicao":true,"collapsed":false,"assigs":[],"hasChild":false},{"id":"987","TaskId":"911f77fb-d7a3-4c73-ba05-1d210e53f5c4","name":"Criar Entrega 4","progress":0,"progressByWorklog":false,"relevance":0,"type":"","code":"3.4.1","level":3,"status":"STATUS_ACTIVE","depends":"22","canWrite":true,"start":1621612800000,"end":1625241600000,"duration":31,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[{"resourceId":"c32d899b-aa78-e911-b076-00155db0cc12","id":"6c55fcd3-cd9c-ec11-b0d4-00155d808220","roleId":"tmp_1","effort":864000000}],"hasChild":true},{"id":"988","TaskId":"18219fdb-b815-4760-838b-6283f20500b1","name":"Testar Entrega 4","progress":0,"progressByWorklog":false,"relevance":0,"type":"","code":"3.4.2","level":3,"status":"STATUS_ACTIVE","depends":"24","canWrite":true,"start":1625241600000,"end":1628870400000,"duration":31,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[{"resourceId":"36a544da-e6c5-e911-b080-00155dac4017","id":"7355fcd3-cd9c-ec11-b0d4-00155d808220","roleId":"tmp_1","effort":864000000}],"hasChild":true},{"id":"989","TaskId":"0b3193f4-8fe2-402c-9e51-49a60f0228e8","name":"Validar Entrega 4","progress":0,"progressByWorklog":false,"relevance":0,"type":"","code":"3.4.3","level":3,"status":"STATUS_ACTIVE","depends":"25","canWrite":true,"start":1628870400000,"end":1628870400000,"duration":1,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[],"hasChild":true},{"id":"990","TaskId":"8ed5d8b7-349c-41a6-a24e-44a68e8c4104","name":"ENCERRAMENTO","progress":0,"progressByWorklog":false,"relevance":0,"type":"","code":"4","level":1,"status":"STATUS_ACTIVE","depends":"","canWrite":true,"start":1628870400000,"end":1631808000000,"duration":24,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[],"hasChild":false},{"id":"991","TaskId":"17a0ca5e-9826-4a26-bc5f-c77128f539e4","name":"REUNIÃO DE ENCERRAMENTO","progress":0,"progressByWorklog":false,"relevance":0,"type":"","code":"4.1","level":2,"status":"STATUS_ACTIVE","depends":"","canWrite":true,"start":1628870400000,"end":1629302400000,"duration":4,"startIsMilestone":false,"endIsMilestone":false,"entrega":true,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[],"hasChild":false},{"id":"992","TaskId":"a5565bce-73ba-4be2-9f62-09ed8db37cbf","name":"Preparar Reunião de Encerramento","progress":0,"progressByWorklog":false,"relevance":0,"type":"","code":"4.1.1","level":3,"status":"STATUS_ACTIVE","depends":"26","canWrite":true,"start":1628870400000,"end":1629216000000,"duration":3,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[{"resourceId":"c32d899b-aa78-e911-b076-00155db0cc12","id":"8c55fcd3-cd9c-ec11-b0d4-00155d808220","roleId":"tmp_1","effort":57600000}],"hasChild":true},{"id":"993","TaskId":"6f6c7dc8-2ef1-4cbe-b8f3-02e1bbabb974","name":"Participar da Reunião de Encerramento","progress":0,"progressByWorklog":false,"relevance":0,"type":"","code":"4.1.2","level":3,"status":"STATUS_ACTIVE","depends":"29","canWrite":true,"start":1629216000000,"end":1629302400000,"duration":2,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[{"resourceId":"36a544da-e6c5-e911-b080-00155dac4017","id":"9355fcd3-cd9c-ec11-b0d4-00155d808220","roleId":"tmp_1","effort":28800000}],"hasChild":true},{"id":"994","TaskId":"e84d8c91-0d64-4b0c-aaa4-5111480cb76e","name":"TERMO DE ENCERRAMENTO","progress":0,"progressByWorklog":false,"relevance":0,"type":"","code":"4.2","level":2,"status":"STATUS_ACTIVE","depends":"","canWrite":true,"start":1629302400000,"end":1631808000000,"duration":21,"startIsMilestone":false,"endIsMilestone":false,"entrega":true,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[],"hasChild":false},{"id":"995","TaskId":"01d58994-bfde-4f7c-a1ed-c5bf3a36a17b","name":"Criar TEP","progress":0,"progressByWorklog":false,"relevance":0,"type":"","code":"4.2.1","level":3,"status":"STATUS_ACTIVE","depends":"30","canWrite":true,"start":1629302400000,"end":1630512000000,"duration":11,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[{"resourceId":"c32d899b-aa78-e911-b076-00155db0cc12","id":"a055fcd3-cd9c-ec11-b0d4-00155d808220","roleId":"tmp_1","effort":288000000}],"hasChild":true},{"id":"996","TaskId":"ce7b8100-3dba-4bab-9e35-2137257a8286","name":"Aprovar TEP","progress":0,"progressByWorklog":false,"relevance":0,"type":"","code":"4.2.2","level":3,"status":"STATUS_ACTIVE","depends":"32","canWrite":true,"start":1630512000000,"end":1631808000000,"duration":11,"startIsMilestone":false,"endIsMilestone":false,"entrega":false,"inspecao":false,"aquisicao":false,"collapsed":false,"assigs":[{"resourceId":"36a544da-e6c5-e911-b080-00155dac4017","id":"a755fcd3-cd9c-ec11-b0d4-00155d808220","roleId":"tmp_1","effort":288000000}],"hasChild":true}],"resources":[{"id":"d9ea99eb-efcf-e911-aefc-a0b3cc177bea","name":"Betoneira"},{"id":"bada7460-8673-eb11-bf8d-00155dbcae07","name":"Desenvolvedor Callegario"},{"id":"3ae5f4d5-4f18-ea11-af04-a0b3cc177bea","name":"Gesso"},{"id":"c32d899b-aa78-e911-b076-00155db0cc12","name":"ingty"},{"id":"902f8268-8bed-e811-afac-00155db02006","name":"Licença de Software"},{"id":"36a544da-e6c5-e911-b080-00155dac4017","name":"Pedreiro"},{"id":"95439d46-26e5-e811-afb9-00155da87707","name":"Piso 40 x 40"},{"id":"dbea99eb-efcf-e911-aefc-a0b3cc177bea","name":"Tijolos"},{"id":"3be5f4d5-4f18-ea11-af04-a0b3cc177bea","name":"Tinta"}],"roles":[{"id":"tmp_1","name":"Time do Projeto"}],"zoom":"1M"};
  */
  return ret;
}


function saveInLocalStorage() {
  var prj = ge.saveProject();

  if (localStorage) {
    localStorage.setObject("teamworkGantDemo", prj);
  }
}


//-------------------------------------------  Open a black popup for managing resources. This is only an axample of implementation (usually resources come from server) ------------------------------------------------------
function editResources(){

  //make resource editor
  var resourceEditor = $.JST.createFromTemplate({}, "RESOURCE_EDITOR");
  var resTbl=resourceEditor.find("#resourcesTable");

  for (var i=0;i<ge.resources.length;i++){
    var res=ge.resources[i];
    resTbl.append($.JST.createFromTemplate(res, "RESOURCE_ROW"))
  }


  //bind add resource
  resourceEditor.find("#addResource").click(function(){
    resTbl.append($.JST.createFromTemplate({id:"new",name:"resource"}, "RESOURCE_ROW"))
  });

  //bind save event
  resourceEditor.find("#resSaveButton").click(function(){
    var newRes=[];
    //find for deleted res
    for (var i=0;i<ge.resources.length;i++){
      var res=ge.resources[i];
      var row = resourceEditor.find("[resId="+res.id+"]");
      if (row.length>0){
        //if still there save it
        var name = row.find("input[name]").val();
        if (name && name!="")
          res.name=name;
        newRes.push(res);
      } else {
        //remove Atribuições
        for (var j=0;j<ge.tasks.length;j++){
          var task=ge.tasks[j];
          var newAss=[];
          for (var k=0;k<task.assigs.length;k++){
            var ass=task.assigs[k];
            if (ass.resourceId!=res.id)
              newAss.push(ass);
          }
          task.assigs=newAss;
        }
      }
    }

    //loop on new rows
    var cnt=0
    resourceEditor.find("[resId=new]").each(function(){
      cnt++;
      var row = $(this);
      var name = row.find("input[name]").val();
      if (name && name!="")
        newRes.push (new Resource("tmp_"+new Date().getTime()+"_"+cnt,name));
    });

    ge.resources=newRes;

    closeBlackPopup();
    ge.redraw();
  });


  var ndo = createModalPopup(400, 500).append(resourceEditor);
}

function initializeHistoryManagement(taskId){

  //retrieve from server the list of history points in millisecond that represent the instant when the data has been recorded
  //response: {ok:true, historyPoints: [1498168800000, 1498600800000, 1498687200000, 1501538400000, …]}
  $.getJSON(contextPath+"/applications/teamwork/task/taskAjaxController.jsp", {CM: "GETGANTTHISTPOINTS", OBJID:taskId}, function (response) {

    //if there are history points
    if (response.ok == true && response.historyPoints && response.historyPoints.length>0) {

      //add show slider button on button bar
      var histBtn = $("<button>").addClass("button textual icon lreq30 lreqLabel").attr("title", "SHOW_HISTORY").append("<span class=\"teamworkIcon\">&#x60;</span>");

      //clicking it
      histBtn .click(function () {
        var el = $(this);
        var ganttButtons = $(".ganttButtonBar .buttons");

        //is it already on?
        if (!ge.element.is(".historyOn")) {
          ge.element.addClass("historyOn");
          ganttButtons.find(".requireCanWrite").hide();

          //load the history points from server again
          showSavingMessage();
          $.getJSON(contextPath + "/applications/teamwork/task/taskAjaxController.jsp", {CM: "GETGANTTHISTPOINTS", OBJID: ge.tasks[0].id}, function (response) {
            jsonResponseHandling(response);
            hideSavingMessage();
            if (response.ok == true) {
              var dh = response.historyPoints;
              if (dh && dh.length > 0) {
                //si crea il div per lo slider
                var sliderDiv = $("<div>").prop("id", "slider").addClass("lreq30 lreqHide").css({"display":"inline-block","width":"500px"});
                ganttButtons.append(sliderDiv);

                var minVal = 0;
                var maxVal = dh.length-1 ;

                $("#slider").show().mbSlider({
                  rangeColor : '#2f97c6',
                  minVal     : minVal,
                  maxVal     : maxVal,
                  startAt    : maxVal,
                  showVal    : false,
                  grid       :1,
                  formatValue: function (val) {
                    return new Date(dh[val]).format();
                  },
                  onSlideLoad: function (obj) {
                    this.onStop(obj);

                  },
                  onStart    : function (obj) {},
                  onStop     : function (obj) {
                    var val = $(obj).mbgetVal();
                    showSavingMessage();
                    /**
                     * load the data history for that milliseconf from server
                     * response in this format {ok: true, baselines: {...}}
                     *
                     * baselines: {61707: {duration:1,endDate:1550271599998,id:61707,progress:40,startDate:1550185200000,status:"STATUS_WAITING",taskId:"3055"},
                     *            {taskId:{duration:in days,endDate:in millis,id:history record id,progress:in percent,startDate:in millis,status:task status,taskId:"3055"}....}}                     */

                    $.getJSON(contextPath + "/applications/teamwork/task/taskAjaxController.jsp", {CM: "GETGANTTHISTORYAT", OBJID: ge.tasks[0].id, millis:dh[val]}, function (response) {
                      jsonResponseHandling(response);
                      hideSavingMessage();
                      if (response.ok ) {
                        ge.baselines=response.baselines;
                        ge.showBaselines=true;
                        ge.baselineMillis=dh[val];
                        ge.redraw();
                      }
                    })

                  },
                  onSlide    : function (obj) {
                    clearTimeout(obj.renderHistory);
                    var self = this;
                    obj.renderHistory = setTimeout(function(){
                      self.onStop(obj);
                    }, 200)

                  }
                });
              }
            }
          });


          // closing the history
        } else {
          //remove the slider
          $("#slider").remove();
          ge.element.removeClass("historyOn");
          if (ge.permissions.canWrite)
            ganttButtons.find(".requireCanWrite").show();

          ge.showBaselines=false;
          ge.baselineMillis=undefined;
          ge.redraw();
        }

      });
      $("#saveGanttButton").before(histBtn);
    }
  })
}

function showBaselineInfo (event,element){
  //alert(element.attr("data-label"));
  $(element).showBalloon(event, $(element).attr("data-label"));
  ge.splitter.secondBox.one("scroll",function(){
    $(element).hideBalloon();
  })
}

</script>





<div id="gantEditorTemplates" style="display:none;">
<div class="__template__" type="GANTBUTTONS"><!-- 
  <div class="ganttButtonBar noprint">
    <div class="buttons">

      <button onclick="$('#workSpace').trigger('undo.gantt');return false;" class="button textual icon requireCanWrite" title="Desfazer"><span class="teamworkIcon">&#39;</span></button>
      <button onclick="$('#workSpace').trigger('redo.gantt');return false;" class="button textual icon requireCanWrite" title="Refazer"><span class="teamworkIcon">&middot;</span></button>
      <span class="ganttButtonSeparator requireCanWrite requireCanAdd"></span>
      <button onclick="$('#workSpace').trigger('addAboveCurrentTask.gantt');return false;" class="button textual icon requireCanWrite requireCanAdd" title="Inserir acima"><span class="teamworkIcon">l</span></button>
      <button onclick="$('#workSpace').trigger('addBelowCurrentTask.gantt');return false;" class="button textual icon requireCanWrite requireCanAdd" title="Insira abaixo"><span class="teamworkIcon">X</span></button>
      <span class="ganttButtonSeparator requireCanWrite requireCanInOutdent"></span>
      <button onclick="$('#workSpace').trigger('outdentCurrentTask.gantt');return false;" class="button textual icon requireCanWrite requireCanInOutdent" title="Recuar Tarefa para a esquerda"><span class="teamworkIcon">.</span></button>
      <button onclick="$('#workSpace').trigger('indentCurrentTask.gantt');return false;" class="button textual icon requireCanWrite requireCanInOutdent" title="Recuar Tarefa para a direita"><span class="teamworkIcon">:</span></button>
      <span class="ganttButtonSeparator requireCanWrite requireCanMoveUpDown"></span>
      <button onclick="$('#workSpace').trigger('moveUpCurrentTask.gantt');return false;" class="button textual icon requireCanWrite requireCanMoveUpDown" title="Mover para cima"><span class="teamworkIcon">k</span></button>
      <button onclick="$('#workSpace').trigger('moveDownCurrentTask.gantt');return false;" class="button textual icon requireCanWrite requireCanMoveUpDown" title="Mover para baixo"><span class="teamworkIcon">j</span></button>
      <span class="ganttButtonSeparator requireCanWrite requireCanDelete"></span>
      <button onclick="$('#workSpace').trigger('deleteFocused.gantt');return false;" class="button textual icon delete requireCanWrite" title="Excluir"><span class="teamworkIcon">&cent;</span></button>
      <span class="ganttButtonSeparator"></span>
      <button onclick="$('#workSpace').trigger('expandAll.gantt');return false;" class="button textual icon " title="EXPAND_ALL"><span class="teamworkIcon">6</span></button>
      <button onclick="$('#workSpace').trigger('collapseAll.gantt'); return false;" class="button textual icon " title="COLLAPSE_ALL"><span class="teamworkIcon">5</span></button>

    <span class="ganttButtonSeparator"></span>
      <button onclick="$('#workSpace').trigger('zoomMinus.gantt'); return false;" class="button textual icon " title="Reduzir o zoom"><span class="teamworkIcon">)</span></button>
      <button onclick="$('#workSpace').trigger('zoomPlus.gantt');return false;" class="button textual icon " title="Ampliar o Zoom"><span class="teamworkIcon">(</span></button>
    <span class="ganttButtonSeparator"></span>
      <button onclick="$('#workSpace').trigger('print.gantt');return false;" class="button textual icon " title="Imprimir"><span class="teamworkIcon">p</span></button>
    <span class="ganttButtonSeparator"></span>
      <button onclick="ge.gantt.showCriticalPath=!ge.gantt.showCriticalPath; ge.redraw();return false;" class="button textual icon requireCanSeeCriticalPath" title="CRITICAL_PATH"><span class="teamworkIcon">&pound;</span></button>
    <span class="ganttButtonSeparator requireCanSeeCriticalPath"></span>
      <button onclick="ge.splitter.resize(.1);return false;" class="button textual icon" ><span class="teamworkIcon">F</span></button>
      <button onclick="ge.splitter.resize(50);return false;" class="button textual icon" ><span class="teamworkIcon">O</span></button>
      <button onclick="ge.splitter.resize(100);return false;" class="button textual icon"><span class="teamworkIcon">R</span></button>
      <span class="ganttButtonSeparator"></span>
      <button onclick="$('#workSpace').trigger('fullScreen.gantt');return false;" class="button textual icon" title="FULLSCREEN" id="fullscrbtn"><span class="teamworkIcon">@</span></button>
      <button onclick="ge.element.toggleClass('colorByStatus' );return false;" class="button textual icon"><span class="teamworkIcon">&sect;</span></button>

    <button onclick="editResources();" class="button textual requireWrite" title="Editar recursos."><span class="teamworkIcon">M</span></button>
      &nbsp; &nbsp; &nbsp; &nbsp;
    </div>

    <div>
      <button onclick="saveGanttOnServer();" class="button first big requireWrite" title="Salvar">Salvar</button>
      <input type="file" name="load-file" id="load-file">
      <label for="load-file">Load</label>
      <button onclick='newProject();' class='button requireWrite newproject'><em>clear project</em></button>
      <button class="button login" title="login/enroll" onclick="loginEnroll($(this));" style="display:none;">login/enroll</button>
      <button class="button opt collab" title="Start with Twproject" onclick="collaborate($(this));" style="display:none;"><em>collaborate</em></button>
    </div>
  </div>
 --></div>

<div class="__template__" type="TASKSEDITHEAD"><!-- 
  <table class="gdfTable" cellspacing="0" cellpadding="0">
    <thead>
    <tr style="height:40px">
      <th class="gdfColHeader" style="width:35px; border-right: none"></th>
      <th class="gdfColHeader" style="width:25px;"></th>
      <th class="gdfColHeader gdfResizable" style="width:100px;">ID</th>
      <th class="gdfColHeader gdfResizable" style="width:300px;">Nome</th>
      <th class="gdfColHeader"  align="center" style="width:17px;" title="A data de início é um marco."><span class="teamworkIcon" style="font-size: 8px;">^</span></th>
      <th class="gdfColHeader gdfResizable" style="width:80px;">Início</th>
      <th class="gdfColHeader"  align="center" style="width:17px;" title="Data de Término é um marco."><span class="teamworkIcon" style="font-size: 8px;">^</span></th>
      <th class="gdfColHeader gdfResizable" style="width:80px;">Término</th>
      <th class="gdfColHeader gdfResizable" style="width:50px;">Dur.</th>
      <th class="gdfColHeader gdfResizable" style="width:20px;">%</th>
      <th class="gdfColHeader gdfResizable requireCanSeeDep" style="width:50px;">Depe.</th>
      <th class="gdfColHeader"  align="center" style="width:60px;" >Entrega</th>
      <th class="gdfColHeader gdfResizable" style="width:1000px; text-align: left; padding-left: 10px;">Atribuições</th>
    </tr>
    </thead>
  </table>
 --></div>

 <div class="__template__" type="TASKROW"><!--
  <tr id="tid_(#=obj.id#)" taskId="(#=obj.id#)" class="taskEditRow (#=obj.isParent()?'isParent':''#) (#=obj.collapsed?'collapsed':''#)" level="(#=level#)">
    <th class="gdfCell edit" align="right" style="cursor:pointer;"><span class="taskRowIndex">(#=obj.getRow()+1#)</span> <span class="teamworkIcon" style="font-size:12px;" >e</span></th>
    <td class="gdfCell noClip" align="center"><div class="taskStatus cvcColorSquare" status="(#=obj.status#)"></div></td>
    <td class="gdfCell"><input type="text" name="code" value="(#=obj.code?obj.code:''#)" placeholder="code/short name"></td>
    <td class="gdfCell indentCell" style="padding-left:(#=obj.level*10+18#)px;">
      <div class="exp-controller" align="center"></div>
      <input type="text" name="name" value="(#=obj.name#)" placeholder="name">
    </td>
    <td class="gdfCell" align="center"><input type="checkbox" name="startIsMilestone"></td>
    <td class="gdfCell"><input type="text" name="start"  value="" class="date"></td>
    <td class="gdfCell" align="center"><input type="checkbox" name="endIsMilestone"></td>
    <td class="gdfCell"><input type="text" name="end" value="" class="date"></td>
    <td class="gdfCell"><input type="text" name="duration" autocomplete="off" value="(#=obj.duration#)"></td>
    <td class="gdfCell"><input type="text" name="progress" class="validated" entrytype="PERCENTILE" autocomplete="off" value="(#=obj.progress?obj.progress:''#)" (#=obj.progressByWorklog?"readOnly":""#)></td>
    <td class="gdfCell requireCanSeeDep"><input type="text" name="depends" autocomplete="off" value="(#=obj.depends#)" (#=obj.hasExternalDep?"readonly":""#)></td>
    <td class="gdfCell" align="center" ><input type="checkbox" name="entrega" (#=obj.entrega?"checked":""#)></td>
    <td class="gdfCell taskAssigs">(#=obj.getAssigsString()#)</td>
  </tr>
  --></div>

<div class="__template__" type="TASKEMPTYROW"><!--
  <tr class="taskEditRow emptyRow" >
    <th class="gdfCell" align="right"></th>
    <td class="gdfCell noClip" align="center"></td>
    <td class="gdfCell"></td>
    <td class="gdfCell"></td>
    <td class="gdfCell"></td>
    <td class="gdfCell"></td>
    <td class="gdfCell"></td>
    <td class="gdfCell"></td>
    <td class="gdfCell"></td>
    <td class="gdfCell"></td>
    <td class="gdfCell requireCanSeeDep"></td>
    <td class="gdfCell"></td>
    <td class="gdfCell"></td>
  </tr>
  --></div>

<div class="__template__" type="TASKBAR"><!--
  <div class="taskBox taskBoxDiv" taskId="(#=obj.id#)" >
    <div class="layout (#=obj.hasExternalDep?'extDep':''#)">
      <div class="taskStatus" status="(#=obj.status#)"></div>
      <div class="taskProgress" style="width:(#=obj.progress>100?100:obj.progress#)%; background-color:(#=obj.progress>100?'red':'rgb(153,255,51);'#);"></div>
      <div class="milestone (#=obj.startIsMilestone?'active':''#)" ></div>

      <div class="taskLabel"></div>
      <div class="milestone end (#=obj.endIsMilestone?'active':''#)" ></div>
    </div>
  </div>
  --></div>


<div class="__template__" type="CHANGE_STATUS"><!--
    <div class="taskStatusBox">
    <div class="taskStatus cvcColorSquare" status="STATUS_ACTIVE" title="Active"></div>
    <div class="taskStatus cvcColorSquare" status="STATUS_DONE" title="Completed"></div>
    <div class="taskStatus cvcColorSquare" status="STATUS_FAILED" title="Failed"></div>
    <div class="taskStatus cvcColorSquare" status="STATUS_SUSPENDED" title="Suspended"></div>
    <div class="taskStatus cvcColorSquare" status="STATUS_WAITING" title="Waiting" style="display: none;"></div>
    <div class="taskStatus cvcColorSquare" status="STATUS_UNDEFINED" title="Undefined"></div>
    </div>
  --></div>




<div class="__template__" type="TASK_EDITOR"><!-- 
  <div class="ganttTaskEditor">
    <h2 class="taskData">Editor de Tarefas</h2>
    <table  cellspacing="1" cellpadding="5" width="100%" class="taskData table" border="0">
          <tr>
        <td width="200" style="height: 80px"  valign="top">
          <label for="code">ID</label><br>
          <input type="text" name="code" id="code" value="" size=15 class="formElements" autocomplete='off' maxlength=255 style='width:100%' oldvalue="1">
        </td>
        <td colspan="3" valign="top"><label for="name" class="required">Nome da Tarefa</label><br><input type="text" name="name" id="name"class="formElements" autocomplete='off' maxlength=255 style='width:100%' value="" required="true" oldvalue="1"></td>
          </tr>


      <tr class="dateRow">
        <td nowrap="">
          <div style="position:relative">
            <label for="start">Início</label>&nbsp;&nbsp;&nbsp;&nbsp;
            <input type="checkbox" id="startIsMilestone" name="startIsMilestone" value="yes"> &nbsp;<label for="startIsMilestone">é marco</label>&nbsp;
            <br><input type="text" name="start" id="start" size="8" class="formElements dateField validated date" autocomplete="off" maxlength="255" value="" oldvalue="1" entrytype="DATE">
            <span title="calendar" id="starts_inputDate" class="teamworkIcon openCalendar" onclick="$(this).dateField({inputField:$(this).prevAll(':input:first'),isSearchField:false});">m</span>          </div>
        </td>
        <td nowrap="">
          <label for="end">Término</label>&nbsp;&nbsp;&nbsp;&nbsp;
          <input type="checkbox" id="endIsMilestone" name="endIsMilestone" value="yes"> &nbsp;<label for="endIsMilestone">é marco</label>&nbsp;
          <br><input type="text" name="end" id="end" size="8" class="formElements dateField validated date" autocomplete="off" maxlength="255" value="" oldvalue="1" entrytype="DATE">
          <span title="calendar" id="ends_inputDate" class="teamworkIcon openCalendar" onclick="$(this).dateField({inputField:$(this).prevAll(':input:first'),isSearchField:false});">m</span>
        </td>
        <td nowrap="" >
          <label for="duration" class=" ">Dias</label><br>
          <input type="text" name="duration" id="duration" size="4" class="formElements validated durationdays" title="Duration is in working days." autocomplete="off" maxlength="255" value="" oldvalue="1" entrytype="DURATIONDAYS">&nbsp;
        </td>
      </tr>

      <tr>
        <td  colspan="2">
          <label for="status" class=" ">status</label><br>
          <select id="status" name="status" class="taskStatus" status="(#=obj.status#)"  onchange="$(this).attr('STATUS',$(this).val());">
            <option value="STATUS_ACTIVE" class="taskStatus" status="STATUS_ACTIVE" >ativa</option>
            <option value="STATUS_WAITING" class="taskStatus" status="STATUS_WAITING" >suspensa</option>
            <option value="STATUS_SUSPENDED" class="taskStatus" status="STATUS_SUSPENDED" >suspensa</option>
            <option value="STATUS_DONE" class="taskStatus" status="STATUS_DONE" >concluída</option>
            <option value="STATUS_FAILED" class="taskStatus" status="STATUS_FAILED" >fracassada</option>
            <option value="STATUS_UNDEFINED" class="taskStatus" status="STATUS_UNDEFINED" >indefinida</option>
          </select>
        </td>

        <td valign="top" nowrap>
          <label>% Concluído</label><br>
          <input type="text" name="progress" id="progress" size="7" class="formElements validated percentile" autocomplete="off" maxlength="255" value="" oldvalue="1" entrytype="PERCENTILE">
        </td>
      </tr>

          </tr>
          <tr>
            <td colspan="4">
              <label for="description">Descrição</label><br>
              <textarea rows="3" cols="30" id="description" name="description" class="formElements" style="width:100%"></textarea>
            </td>
          </tr>
        </table>

    <h2>Atribuições</h2>
  <table  cellspacing="1" cellpadding="0" width="100%" id="assigsTable">
    <tr>
      <th style="width:100px;">nome</th>
      <th style="width:70px;">Função</th>
      <th style="width:30px;">est.wklg.</th>
      <th style="width:30px;" id="addAssig"><span class="teamworkIcon" style="cursor: pointer">+</span></th>
    </tr>
  </table>

  <div style="text-align: right; padding-top: 20px">
    <span id="saveButton" class="button first" onClick="$(this).trigger('saveFullEditor.gantt');">Salvar</span>
  </div>

  </div> 
--></div>



<div class="__template__" type="ASSIGNMENT_ROW"><!--
  <tr taskId="(#=obj.task.id#)" assId="(#=obj.assig.id#)" class="assigEditRow" >
    <td ><select name="resourceId"  class="formElements" (#=obj.assig.id.indexOf("tmp_")==0?"":"disabled"#) ></select></td>
    <td ><select type="select" name="roleId"  class="formElements"></select></td>
    <td ><input type="text" name="effort" value="(#=getMillisInHoursMinutes(obj.assig.effort)#)" size="5" class="formElements"></td>
    <td align="center"><span class="teamworkIcon delAssig del" style="cursor: pointer">d</span></td>
  </tr>
  --></div>



<div class="__template__" type="RESOURCE_EDITOR"><!--
  <div class="resourceEditor" style="padding: 5px;">

    <h2>Project team</h2>
    <table  cellspacing="1" cellpadding="0" width="100%" id="resourcesTable">
      <tr>
        <th style="width:100px;">name</th>
        <th style="width:30px;" id="addResource"><span class="teamworkIcon" style="cursor: pointer">+</span></th>
      </tr>
    </table>

    <div style="text-align: right; padding-top: 20px"><button id="resSaveButton" class="button big">Salvar</button></div>
  </div>
  --></div>



<div class="__template__" type="RESOURCE_ROW"><!--
  <tr resId="(#=obj.id#)" class="resRow" >
    <td ><input type="text" name="name" value="(#=obj.name#)" style="width:100%;" class="formElements"></td>
    <td align="center"><span class="teamworkIcon delRes del" style="cursor: pointer">d</span></td>
  </tr>
  --></div>


</div>
<script type="text/javascript">
  $.JST.loadDecorator("RESOURCE_ROW", function(resTr, res){
    resTr.find(".delRes").click(function(){$(this).closest("tr").remove()});
  });

  $.JST.loadDecorator("ASSIGNMENT_ROW", function(assigTr, taskAssig){
    var resEl = assigTr.find("[name=resourceId]");
    var opt = $("<option>");
    resEl.append(opt);
    for(var i=0; i< taskAssig.task.master.resources.length;i++){
      var res = taskAssig.task.master.resources[i];
      opt = $("<option>");
      opt.val(res.id).html(res.name);
      if(taskAssig.assig.resourceId == res.id)
        opt.attr("selected", "true");
      resEl.append(opt);
    }
    var roleEl = assigTr.find("[name=roleId]");
    for(var i=0; i< taskAssig.task.master.roles.length;i++){
      var role = taskAssig.task.master.roles[i];
      var optr = $("<option>");
      optr.val(role.id).html(role.name);
      if(taskAssig.assig.roleId == role.id)
        optr.attr("selected", "true");
      roleEl.append(optr);
    }

    if(taskAssig.task.master.permissions.canWrite && taskAssig.task.canWrite){
      assigTr.find(".delAssig").click(function(){
        var tr = $(this).closest("[assId]").fadeOut(200, function(){$(this).remove()});
      });
    }

  });


  function loadI18n(){
    GanttMaster.messages = {
      "CANNOT_WRITE":"Nenhuma permissão para alterar a seguinte tarefa:",
      "CHANGE_OUT_OF_SCOPE":"Atualização do projeto não é possível, pois você não tem direitos para atualizar um projeto pai.",
      "START_IS_MILESTONE":"A data de início é um marco.",
      "END_IS_MILESTONE":"Data final é um marco.",
      "TASK_HAS_CONSTRAINTS":"Tarefa tem restrições.",
      "GANTT_ERROR_DEPENDS_ON_OPEN_TASK":"Erro: Existe uma dependência de uma tarefa aberta.",
      "GANTT_ERROR_DESCENDANT_OF_CLOSED_TASK":"Erro: devido a um descendente de uma tarefa fechada.",
      "TASK_HAS_EXTERNAL_DEPS":"Esta tarefa tem dependências externas.",
      "GANNT_ERROR_LOADING_DATA_TASK_REMOVED":"GANNT_ERROR_LOADING_DATA_TASK_REMOVED",
      "CIRCULAR_REFERENCE":"Referencia circular.",
      "CANNOT_DEPENDS_ON_ANCESTORS":"Não pode depender de ancestrais.",
      "INVALID_DATE_FORMAT":"Os dados inseridos são inválidos para o formato de campo.",
      "GANTT_ERROR_LOADING_DATA_TASK_REMOVED":"Ocorreu um erro ao carregar os dados.Uma tarefa foi destruída.",
      "CANNOT_CLOSE_TASK_IF_OPEN_ISSUE":"Não é possível fechar uma tarefa com problemas abertos",
      "TASK_MOVE_INCONSISTENT_LEVEL":"Você não pode trocar tarefas de profundidade diferente.",
      "CANNOT_MOVE_TASK":"CANNOT_MOVE_TASK",
      "PLEASE_SAVE_PROJECT":"PLEASE_SAVE_PROJECT",
      "GANTT_SEMESTER":"Semestre",
      "GANTT_SEMESTER_SHORT":"s.",
      "GANTT_QUARTER":"Trimestre",
      "GANTT_QUARTER_SHORT":"t.",
      "GANTT_WEEK":"Semana",
      "GANTT_WEEK_SHORT":"S."
    };
  }



  function createNewResource(el) {
    var row = el.closest("tr[taskid]");
    var name = row.find("[name=resourceId_txt]").val();
    var url = contextPath + "/applications/teamwork/resource/resourceNew.jsp?CM=ADD&name=" + encodeURI(name);

    openBlackPopup(url, 700, 320, function (response) {
      //fillare lo smart combo
      if (response && response.resId && response.resName) {
        //fillare lo smart combo e chiudere l'editor
        row.find("[name=resourceId]").val(response.resId);
        row.find("[name=resourceId_txt]").val(response.resName).focus().blur();
      }

    });
  }

$(document).on("change", "#load-file", function() {
  var uploadedFile = $("#load-file").prop("files")[0];
  upload(uploadedFile);
});

</script>






</body>
</html>